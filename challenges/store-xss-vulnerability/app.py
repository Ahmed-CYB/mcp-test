# Main application
# Vulnerable to: Stored XSS
from flask import Flask, render_template, request, redirect, url_for, make_response
import os

app = Flask(__name__)

reviews = []  # In-memory storage for simplicity

@app.route('/product/<int:product_id>', methods=['GET', 'POST'])
def product_page(product_id):
    if request.method == 'POST':
        username = request.form.get('username')
        comment = request.form.get('comment')
        if username and comment:
            reviews.append({'username': username, 'comment': comment, 'product_id': product_id})
    product_reviews = [r for r in reviews if r['product_id'] == product_id]
    return render_template('product.html', product_id=product_id, reviews=product_reviews)

@app.route('/')
def index():
    return redirect(url_for('product_page', product_id=1))

@app.route('/admin')
def admin():
    # Simulate admin login and set cookie
    resp = make_response("<h1>Admin Dashboard</h1><p>Your secret admin cookie is set!</p>")
    resp.set_cookie('admin_cookie', 'super_secret_admin_value')
    return resp

if __name__ == '__main__':
    app.run(host='0.0.0.0', port=8080)
