FROM debian:bookworm-slim
RUN apt-get update && apt-get install -y samba && rm -rf /var/lib/apt/lists/*
RUN useradd -m smbuser && echo 'smbuser:smbpassword' | chpasswd
RUN (echo 'smbpassword'; echo 'smbpassword') | smbpasswd -a smbuser -s
COPY smb.conf /etc/samba/smb.conf
COPY flag.txt /srv/smb/flag.txt
RUN chown smbuser:smbuser /srv/smb/flag.txt && chmod 644 /srv/smb/flag.txt
EXPOSE 139 445
CMD ["smbd", "--foreground", "--log-stdout"]