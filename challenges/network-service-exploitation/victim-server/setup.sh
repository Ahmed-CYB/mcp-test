#!/bin/bash
# Victim server setup script

echo "[+] Setting up victim-server..."

# Install services
apt update
apt install -y vsftpd openssh-server

# Create users
useradd -m -s /bin/bash backup
useradd -m -s /bin/bash ftpuser  
useradd -m -s /bin/bash admin

# Set weak passwords
echo 'backup:backup123!' | chpasswd
echo 'ftpuser:ftp123' | chpasswd
echo 'admin:admin123' | chpasswd

# Create directory structure
mkdir -p /var/ftp/pub
mkdir -p /home/backup/.ssh
mkdir -p /home/backup/secret

# Set permissions for FTP anonymous access
chown ftp:ftp /var/ftp/pub
chmod 755 /var/ftp/pub
chmod 777 /var/ftp/pub  # Vulnerable - world writable

# Copy configuration files
cp vsftpd.conf /etc/vsftpd/
cp vsftpd.userlist /etc/
cp sshd_config /etc/ssh/

# Place sensitive files
cp backup_config.txt /var/ftp/pub/
cp flag.txt /home/backup/secret/
cp id_rsa /home/backup/.ssh/

# Set SSH key permissions
chmod 600 /home/backup/.ssh/id_rsa
chown backup:backup /home/backup/.ssh/id_rsa
chown backup:backup /home/backup/secret/flag.txt
chmod 400 /home/backup/secret/flag.txt

# Start services
systemctl enable vsftpd
systemctl start vsftpd
systemctl enable ssh
systemctl start ssh

echo "[+] Setup complete!"
echo "[+] FTP anonymous access enabled on port 21"
echo "[+] SSH service running on port 22"
echo "[+] Flag located at: /home/backup/secret/flag.txt"